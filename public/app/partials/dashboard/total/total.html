<h3>Total statistic
    <a><span class="glyphicon glyphicon-question-sign small pull-right" ng-click="open('dashboard/total')"></span></a>
</h3>
<hr>
<div class="text-center" ng-class="{ 'disabled': !formErrors, 'alert alert-warning': formErrors}"
     role="alert">{{ formErrors }}
</div>

<div class="row col-md-4">
    <div ng-show="tableParams"><b>Group by:</b>
        <div class="btn-group btn-group-xs" role="group" aria-label="...">
            <button type="button" class="btn btn-default" ng-click="initGroupBy='version'">version</button>
            <button type="button" class="btn btn-default" ng-click="initGroupBy='testplan'">testplan</button>
            <button type="button" class="btn btn-default active" ng-click="initGroupBy='suite'">suite</button>
            <button type="button" class="btn btn-default" ng-click="initGroupBy='name'">test name</button>
        </div>
    </div>
</div>
<div class="row col-md-8 pull-right">
    <table class="pull-right">
        <tr>
            <td><b>Columns: </b></td>
            <td ng-repeat="column in columns" style="padding-left: 10px;">
                <input type="checkbox" ng-model="column.visible" />
                <small style="position: relative;top: -2px;">{{column.title}}</small>
            </td>
        </tr>
    </table>
</div>
<div class="row"></div>
<hr style="border-color: transparent;">
<div>
  <table ng-show="tableParams" ng-table="tableParams" show-filter="true"
         class="table table-condensed table-bordered table-hover table-striped"
          template-pagination="removePageRow.html">
    <tbody ng-repeat="group in $groups">
      <tr class="ng-table-group" >
        <td colspan="{{ $columns.length }}">
            <a href="" ng-click="group.$hideRows = !group.$hideRows" style="text-decoration: none;">
                <span class="glyphicon" ng-class="{ 'glyphicon-chevron-right': !group.$hideRows, 'glyphicon-chevron-down': group.$hideRows }"></span>
                <b>{{ group.value }} </b>
                <div class="pull-right">
                    <span class="label label-danger label-balanced">
                        {{ group.data.length }}
                    </span>
                </div>
            </a>
        </td>
      </tr>
        <tr ng-hide="group.$hideRows" ng-repeat="test in group.data"
            ng-click="redirect($event, '/testresult/' + test.id)" style="cursor:pointer" ng-class="{'hidden': test.hidden }">
            <td data-title="'Date'" class="text-center" style="width: 7em;" sortable="'launch'">
                {{ test.created | date:"dd.MM HH:mm" }}
            </td>
            <td data-title="'Version'" class="text-center" style="width: 7em;" filter="{'version': 'text'}"
                sortable="'version'" ng-show="getColumnVisibility('Version')">
                {{ test.version | cut:true:12:'..'  }}
            </td>
            <td data-title="'Hash'" class="text-center" style="width: 7em;" filter="{'hash': 'text'}"
                sortable="'hash'" ng-show="getColumnVisibility('Hash')">
                {{ test.hash | cut:true:12:'..' }}
            </td>
            <td data-title="'Branch'" class="text-center" style="width: 7em;" filter="{'branch': 'text'}"
                sortable="'branch'" ng-show="getColumnVisibility('Branch')">
                {{ test.branch | cut:true:12:'..' }}
            </td>
            <td data-title="'Testplan'" style="width: 12em;" filter="{'testplan': 'text'}" sortable="'testplan'"
                    ng-show="getColumnVisibility('Testplan')">
                <div class="panel-tree-view">{{ test.testplan }}</div>
            </td>
            <td data-title="'Suite'" sortable="'suite'" filter="{'suite': 'text'}" ng-show="getColumnVisibility('Suite')">
                <div class="panel-tree-view"> {{ test.suite | cut:true:24:'..'}}</div>
            </td>
            <td data-title="'Test name'" filter="{'name': 'text'}" style="padding-bottom: 1px;" sortable="'name'">
                <div class="panel panel-default panel-tree-view" style="margin-bottom: 5px;">
                    <div class="panel-body" style="background-color: whitesmoke; padding: 10px; padding-bottom: 5px;">
                        {{ test.name }}
                    </div>
                </div>
            </td>
            <!--<td data-title="'state'" style="width: 4em;">-->
                <!--<span class="{{ test.state | testStatesClass }}">{{ test.state | testStates }}</span>-->
            <!--</td>-->
            <td data-title="'sec.'" style="width: 2em;" sortable="'duration'" ng-show="getColumnVisibility('sec.')">{{ test.duration | toFixed }}</td>
            <td data-title="'Bugs'" style="width: 4em;" ng-show="getColumnVisibility('Bugs')">
                <div ng-repeat="bug in test.bugs">
                    <a class="label label-{{ bug.status | bugStatusClass }}"
                       href="https://jira.2gis.ru/browse/{{ bug.externalId }}"
                       title="{{ bug.name }}">{{ bug.externalId }}</a>
                </div>
            </td>
        </tr>
    </tbody>
  </table>
</div>

<div class="modal modal-wide" id="TestDetailsModal" tabindex="-1" role="dialog"
         aria-labelledby="TestDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" style="width: 70%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="TestDetailsModalLabel">
                    {{ modalSuite }}
                    <br/>
                    <b>{{ modalName }}</b>
                </h4>
            </div>
            <div class="modal-body" style="overflow-y: auto;">
                <pre ng-bind-html="modalBody | linky:'_blank'"></pre>
            </div>
            <div class="modal-footer">
                <a  class="btn" ng-href="#testresult/{{ modalId }}/">Open detailed view <i class="glyphicon glyphicon-share"></i></a>
            </div>
        </div>
    </div>
</div>